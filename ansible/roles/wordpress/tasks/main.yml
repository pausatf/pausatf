---
# WordPress application management only (no webserver here)
# - uses WP-CLI to manage core, plugins, and themes
# - honors per-install settings in group_vars

- name: Ensure WP-CLI is installed
  get_url:
    url: https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar
    dest: /usr/local/bin/wp
    mode: '0755'
  when: wpcli_enabled | default(true)

- name: Iterate configured WordPress installs
  include_tasks: manage-install.yml
  loop: "{{ wordpress_installs | default([]) }}"
  loop_control:
    loop_var: wp_site
